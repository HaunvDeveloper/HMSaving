@{
    ViewData["Title"] = "Công Nợ giao dịch";
    var culture = new System.Globalization.CultureInfo("vi-VN");
}

<div class="container mt-4 p-3">
    <h2 class="text-center text-uppercase">Danh sách Đối tác</h2>
    <div class="mb-3 mt-3 d-flex gap-2 justify-content-between">
        <div class="d-flex flex-wrap gap-2">
            <button id="btnAddDesktop" class="btn btn-success btnAddPartner  d-none d-md-block">
                <i class="bi bi-plus-lg"></i> Thêm đối tác
            </button>
            <a href="/Debt/CreateDebtTogether" class="btn btn-primary fst-normal">
                <i class="bi bi-plus-lg"></i> Chia nợ chung
                </a>
        </div>
        
        <!--Searching-->
        <div class="input-group w-50">
            <input type="text" id="searchInput" class="form-control" placeholder="Tìm kiếm đối tác...">
        </div>
    </div>
    <div id="debtSummaryContainer"></div>

    <button id="btnAddMobile"
            class="btn btn-primary rounded-circle shadow-lg d-md-none btnAddPartner"
            style="position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; z-index:1000;">
        <i class="bi bi-plus-lg fs-4"></i>
    </button>
</div>
@section Links {
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
}
@section Scripts {
    <script>
        $(document).ready(function () {

            // Load the debt summary partial view
            $('#debtSummaryContainer').html('<h6>Đang tải dữ liệu...</h6>')
            $('#debtSummaryContainer').load('/Debt/DebtSummaryPartial');
            

            // Search functionality
            $('#searchInput').on('input', function () {
                var searchTerm = $(this).val().toLowerCase();
                $('#debtSummaryContainer .partner-card').each(function () {
                    var partnerName = $(this).data('partner-name').toLowerCase();
                    if (partnerName.includes(searchTerm)) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            });


           
        });
    </script>

    <script>
        $('.btnAddPartner').click(function () {
            Swal.fire({
                title: 'Thêm đối tác mới',
                input: 'text',
                inputLabel: 'Tên đối tác',
                inputPlaceholder: 'Nhập tên đối tác...',
                showCancelButton: true,
                confirmButtonText: 'Thêm',
                cancelButtonText: 'Hủy',
                preConfirm: (name) => {
                    if (!name) {
                        Swal.showValidationMessage('Vui lòng nhập tên đối tác');
                        return false;
                    }
                    return fetch('/Partner/QuickCreate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': $('input[name="__RequestVerificationToken"]').val()
                        },
                        body: JSON.stringify({ partnerName: name })
                    }).then(res => {
                        if (!res.ok) throw new Error('Thêm thất bại');
                        return res.json();
                    }).catch(err => {
                        Swal.showValidationMessage(`Lỗi: ${err}`);
                    });
                }
            }).then((result) => {
                if (result.isConfirmed && result.value) {
                    window.location.reload();
                }
            });
        });
    </script>
}
